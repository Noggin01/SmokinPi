#include <stdint.h>
#include <stdbool.h>
#include <stdio.h>
#include <stdlib.h>
#include <pthread.h>
#include <time.h>
#include <string.h>
#include <math.h>
#include <ncurses.h>
#include "main.h"
#include "thermistor.h"
#include "tlc1543.h"
#include "app.h"
#include "cmd_line.h"

/* *** Constants *** */
#define nan					(1/0)
/* *** Types *** */

/* *** Global Variables *** */
#if 0
const static double conversion_coefficients[NBR_THERMISTOR_TYPES][NBR_OF_COEFFICIENTS] =
{
	{ -1.07141580387266E-11, 3.71346262993203E-08, -5.18467410539453E-05, 0.0363008256347458, -12.9765706452615, 2160.07499094298 },	   // CDDT Replacement Thermistor
	{ -2.59799933143503E-12, 6.61760177285894E-09, -6.86167983753389E-06, 0.00368089722332718, -1.23009384419463, 371.041602633187 },	// Taylor Thermometer
};
#endif

/* *** Function Declarations *** */
float Thermistor_Convert_Adc_To_Deg_F( uint16_t adc );

/***************************************************************************************************
@brief Initialization routine for the thermistor module.
***************************************************************************************************/
void Thermistor_Init( void )
{
	// Aint got shit to do right now
	printf("Thermistor data initialized\n");
}

/***************************************************************************************************
When new ADC data is available, convert it to temperature in Deg F
***************************************************************************************************/
void Thermistor_Service( uint16_t *p_adc_data, float *p_temperature_data )
{
	#define PRINT_DELAY					(250000/MAIN_LOOP_TIME_US)	/* 250 milliseconds */
	uint8_t i;
	float degf;
	int y, x;
	static int timer = 0;
	static bool initialized = false;
	
	// Convert each of the ADC data points to temperature data
	for (i = 0; i < NBR_OF_THERMISTORS; i++)
	{
		degf = Thermistor_Convert_Adc_To_Deg_F( p_adc_data[i] );
		if (initialized)
			p_temperature_data[i] = ((p_temperature_data[i] * 9.0) + degf)/10.0;
		else
			p_temperature_data[i] = degf;
	}

	initialized = true;
	
	// Print temperature information to the console for easy monitoring
	if (timer++ >= PRINT_DELAY)
	{
		timer = 0;
		getyx(stdscr, y, x);
		move( 0, 0 );
		for (i = 0; i < NBR_OF_THERMISTORS; i++)
			printw("%3u:%7.2f", i, p_temperature_data[i]);
		printw("          \n");
		move( 1, 0 );
		for (i = 0; i < NBR_OF_THERMISTORS; i++)
			printw("%3u:%7d", i, p_adc_data[i] );
		move( y, x );
	}
}

#if 0
Neither of these thermistors are used any longer.  Suggested thermistor is Maverick PR-005
/***************************************************************************************************
Determine which type of thermistor each this conversion is for.  Then calculate the temperature 
using a polynomial forumla obtained with ADC vs Temperature plots in Excel.
***************************************************************************************************/
float Thermistor_Cddt_Convert_Adc_To_Deg_F( uint16_t adc, uint8_t thermistor_index )
{
	double temp_deg_f;
	unsigned int thermistor_type;

	switch (thermistor_index)
	{
//		case 0:
//		case 1:
//			thermistor_type = TAYLOR_THERMISTOR;
//			break;

		default:
			thermistor_type = CDDT_THERMISTOR;
			break;
	}

	// Convert the ADC reading to temperature in Â°F using the polynomial formula
	// Temperature = Ax^5 + Bx^4 + Cx^3 + Dx^2 + Ex + F
	temp_deg_f  = conversion_coefficients[thermistor_type][0] * adc * adc * adc * adc * adc;
	temp_deg_f += conversion_coefficients[thermistor_type][1] * adc * adc * adc * adc;
	temp_deg_f += conversion_coefficients[thermistor_type][2] * adc * adc * adc;
	temp_deg_f += conversion_coefficients[thermistor_type][3] * adc * adc;
	temp_deg_f += conversion_coefficients[thermistor_type][4] * adc;
	temp_deg_f += conversion_coefficients[thermistor_type][5];

	return (float)temp_deg_f;
}
#endif

/** ***********************************************************************************************
@brief Convert ADC readings to temperature values using a 10k Maverick PR-005 thermistor and a 
10k pull-up resistor.

The look-up-table was generated in Excel using the formula found on the following web page:
http://capnbry.net/linkmeter/adctherm/#p1t=6&p1r=10000&p2t=0&p2r=10000
**************************************************************************************************/
float Thermistor_Convert_Adc_To_Deg_F( uint16_t adc )
{
   static const float adc_to_temp[] = {
      2000.00000000000, 1869.97102009924, 1457.33796276713, 1276.38196730912, 1166.9344985131,
      1090.81711944121, 1033.52781973724, 988.155713242446, 950.919533228327, 919.546679233174,
      892.574769648293, 869.012564919305, 848.160082990216, 829.506367507427, 812.668096903122,
      797.351015936876, 783.324773916402, 770.405975535739, 758.446445413707, 747.324906002509,
      736.940951003388, 727.210599412404, 718.062960984136, 709.437697941487, 701.28306680374,
      693.554389337324, 686.212845343871, 679.224509878771, 672.55957826286,  666.191736910305,
      660.097648491066, 654.256527557974, 648.649788355492, 643.260750674179, 638.074392724891,
      633.077142361871, 628.256699783433, 623.601886225744, 619.102514242426, 614.749276005699,
      610.53364672919,  606.447800839688, 602.484538945935, 598.63722399059,  594.899725244494,
      591.26636902407,  587.731895193656, 584.291418662965, 580.940395212157, 577.674591078236,
      574.490055820587, 571.383098053666, 568.350263693671, 565.38831641546,  562.494220057714,
      559.665122749647, 556.89834256262,  554.191354515536, 551.541778784784, 548.947369988246,
      546.406007428951, 543.915686197885, 541.47450904745,  539.080678957447, 536.73249232452,
      534.428332713839, 532.166665118651, 529.946030679366, 527.765041819053, 525.622377756869,
      523.51678036501,  521.447050338331, 519.412043648965, 517.410668261072, 515.441881083306,
      513.504685138842, 511.598126934706, 509.721294013941, 507.873312675692, 506.053345849669,
      504.260591112723, 502.494278836361, 500.753670455045, 499.038056846024, 497.346756812252,
      495.679115660675, 494.034503868854, 492.412315833446, 490.811968694655, 489.232901231214,
      487.674572820922, 486.136462462164, 484.618067852197, 483.118904518331, 481.638504998434,
      480.17641806745,  478.732208006908, 477.305453914594, 475.89574905179,  474.502700225671,
      473.125927204627, 471.765062164455, 470.419749163473, 469.08964364481,  467.774411964186,
      466.473730941659, 465.1872874359,   463.914777939654, 462.655908195167, 461.410392828384,
      460.177955000865, 458.958326078395, 457.751245315343, 456.556459553891, 455.373722937306,
      454.202796636477, 453.043448588999, 451.895453250122, 450.758591354924, 449.632649691123,
      448.517420881951, 447.412703178574, 446.318300261558, 445.234021050925, 444.15967952434,
      443.095094543042, 442.040089685113, 440.994493085721, 439.958137284007, 438.930859076267,
      437.912499375144, 436.902903074523, 435.901918919873, 434.909399383756, 433.925200546279,
      432.949181980248, 431.981206640802, 431.02114075933,  430.068853741464, 429.124218068976,
      428.187109205385, 427.257405505128, 426.334988126115, 425.419740945539, 424.511550478786,
      423.610305801306, 422.715898473336, 421.828222467324, 420.947174097971, 420.072651954751,
      419.204556836824, 418.34279169023,  417.487261547283, 416.637873468052, 415.794536483874,
      414.957161542781, 414.125661456798, 413.29995085101,  412.479946114341, 411.665565351977,
      410.856728339356, 410.053356477686, 409.255372750907, 408.462701684053, 407.675269302969,
      406.893003095309, 406.115831972785, 405.343686234618, 404.576497532127, 403.814198834447,
      403.056724395298, 402.304009720793, 401.555991538236, 400.81260776587,  400.073797483553,
      399.339500904313, 398.609659346767, 397.884215208357, 397.163111939391, 396.446294017841,
      395.733706924889, 395.02529712119,  394.321012023815, 393.620799983873, 392.924610264771,
      392.23239302109,  391.544099278073, 390.859680911688, 390.179090629247, 389.502281950577,
      388.829209189708, 388.159827437073, 387.494092542192, 386.831961096837, 386.173390418654,
      385.518338535225, 384.866764168567, 384.21862672004,  383.573886255663, 382.932503491818,
      382.294439781334, 381.659657099929, 381.028118033021, 380.399785762869, 379.774624056051,
      379.152597251273, 378.533670247476, 377.917808492259, 377.304977970591, 376.695145193806,
      376.088277188882, 375.484341487979, 374.883306118247, 374.285139591882, 373.689810896423,
      373.097289485299, 372.507545268595, 371.920548604051, 371.336270288273, 370.754681548165,
      370.175754032551, 369.599459804015, 369.025771330923, 368.454661479637, 367.886103506915,
      367.320071052484, 366.756538131795, 366.195479128934, 365.63686878971,  365.080682214894,
      364.526894853615, 363.975482496907, 363.426421271405, 362.879687633182, 362.33525836172,
      361.793110554027, 361.253221618875, 360.715569271173, 360.180131526461, 359.646886695528,
      359.115813379148, 358.586890462923, 358.060097112258, 357.535412767422, 357.012817138728,
      356.492290201821, 355.973812193054, 355.457363604972, 354.94292518189,  354.430477915563,
      353.92000304095,  353.411482032062, 352.904896597905, 352.400228678495, 351.897460440971,
      351.396574275776, 350.89755279292,  350.400378818325, 349.905035390235, 349.411505755707,
      348.919773367169, 348.429821879051, 347.941635144475, 347.455197212024, 346.970492322568,
      346.487504906148, 346.006219578936, 345.526621140238, 345.048694569572, 344.572425023789,
      344.097797834259, 343.624798504112, 343.153412705523, 342.683626277062, 342.215425221083,
      341.748795701174, 341.283724039645, 340.820196715071, 340.358200359881, 339.897721757985,
      339.438747842458, 338.981265693254, 338.525262534974, 338.070725734666, 337.617642799674,
      337.16600137552,  336.715789243828, 336.266994320286, 335.819604652646, 335.373608418755,
      334.92899392463,  334.485749602561, 334.04386400925,  333.603325823987, 333.16412384685,
      332.726246996946, 332.289684310681, 331.854424940053, 331.420458150986, 330.987773321686,
      330.556359941031, 330.12620760698,  329.697306025022, 329.26964500664,  328.843214467811,
      328.418004427524, 327.994005006331, 327.571206424914, 327.149599002684, 326.729173156399,
      326.309919398809, 325.891828337321, 325.474890672684, 325.059097197705, 324.644438795976,
      324.230906440626, 323.818491193101, 323.407184201947, 322.996976701633, 322.587860011378,
      322.179825534003, 321.772864754805, 321.366969240441, 320.962130637838, 320.558340673117,
      320.155591150531, 319.753873951429, 319.353181033227, 318.953504428398, 318.554836243486,
      318.157168658121, 317.760493924062, 317.364804364249, 316.970092371872, 316.576350409453,
      316.183571007941, 315.791746765828, 315.400870348267, 315.010934486215, 314.621931975585,
      314.233855676403, 313.846698511993, 313.460453468163, 313.075113592406, 312.690671993114,
      312.307121838806, 311.924456357361, 311.54266883527,  311.161752616893, 310.781701103732,
      310.40250775371,  310.024166080465, 309.646669652652, 309.270012093253, 308.894187078905,
      308.519188339227, 308.145009656164, 307.77164486334,  307.399087845418, 307.027332537469,
      306.656372924353, 306.286203040107, 305.916816967337, 305.548208836631, 305.180372825966,
      304.813303160134, 304.44699411017,  304.08143999279,  303.716635169835, 303.35257404773,
      302.989251076939, 302.626660751435, 302.26479760818,  301.903656226601, 301.543231228084,
      301.183517275472, 300.824509072564, 300.466201363632, 300.10858893293,  299.751666604226,
      299.395429240324, 299.039871742608, 298.684989050575, 298.330776141393, 297.977228029448,
      297.624339765908, 297.272106438286, 296.920523170016, 296.569585120026, 296.219287482322,
      295.869625485575, 295.520594392719, 295.172189500543, 294.824406139298, 294.477239672307,
      294.130685495573, 293.784739037407, 293.439395758042, 293.094651149267, 292.750500734056,
      292.406940066209, 292.06396472999,  291.721570339776, 291.379752539708, 291.038507003342,
      290.697829433312, 290.357715560992, 290.018161146163, 289.679161976685, 289.340713868171,
      289.002812663668, 288.665454233339, 288.328634474149, 287.992349309558, 287.656594689213,
      287.321366588645, 286.986661008974, 286.65247397661,  286.318801542964, 285.985639784155,
      285.652984800733, 285.320832717388, 284.989179682678, 284.658021868751, 284.327355471073,
      283.997176708156, 283.667481821299, 283.338267074318, 283.009528753285, 282.681263166278,
      282.353466643119, 282.026135535126, 281.69926621486,  281.372855075886, 281.046898532521,
      280.721393019598, 280.396334992226, 280.071720925553, 279.747547314535, 279.423810673704,
      279.100507536936, 278.777634457231, 278.455188006484, 278.133164775268, 277.811561372608,
      277.490374425772, 277.169600580049, 276.849236498544, 276.529278861958, 276.209724368389,
      275.890569733119, 275.571811688413, 275.253446983316, 274.935472383453, 274.617884670828,
      274.300680643634, 273.98385711605,  273.667410918054, 273.351338895233, 273.035637908587,
      272.720304834351, 272.405336563802, 272.090730003078, 271.776482072997, 271.462589708874,
      271.149049860343, 270.835859491183, 270.523015579136, 270.210515115738, 269.898355106143,
      269.586532568957, 269.275044536061, 268.963888052449, 268.65306017606,  268.342557977608,
      268.032378540427, 267.722518960298, 267.412976345298, 267.103747815631, 266.794830503477,
      266.48622155283,  266.17791811934,  265.869917370168, 265.562216483819, 265.25481265,
      264.947703069465, 264.640884953862, 264.334355525591, 264.02811201765,  263.722151673488,
      263.416471746865, 263.111069501703, 262.805942211941, 262.501087161398, 262.196501643625,
      261.892182961769, 261.588128428431, 261.284335365528, 260.980801104156, 260.677522984451,
      260.374498355454, 260.071724574978, 259.769199009469, 259.466919033877, 259.164882031522,
      258.86308539396,  258.561526520856, 258.26020281985,  257.959111706429, 257.658250603799,
      257.357616942756, 257.05720816156,  256.757021705805, 256.457055028296, 256.157305588924,
      255.85777085454,  255.55844829883,  255.259335402195, 254.960429651625, 254.661728540577,
      254.363229568857, 254.064930242494, 253.766828073621, 253.468920580358, 253.171205286689,
      252.873679722344, 252.576341422681, 252.279187928568, 251.982216786265, 251.685425547307,
      251.388811768387, 251.09237301124,  250.796106842527, 250.500010833722, 250.204082560992,
      249.908319605086, 249.61271955122,  249.317279988961, 249.021998512117, 248.72687271862,
      248.431900210414, 248.137078593344, 247.842405477041, 247.547878474811, 247.253495203523,
      246.959253283496, 246.665150338389, 246.371183995088, 246.077351883597, 245.783651636925,
      245.490080890977, 245.19663728444,  244.903318458676, 244.610122057611, 244.317045727623,
      244.024087117433, 243.731243877995, 243.438513662386, 243.145894125695, 242.853382924915,
      242.560977718829, 242.268676167908, 241.976475934193, 241.68437468119,  241.392370073757,
      241.100459777998, 240.808641461151, 240.516912791476, 240.225271438149, 239.933715071149,
      239.64224136115,  239.350847979408, 239.059532597654, 238.768292887979, 238.477126522729,
      238.18603117439,  237.895004515478, 237.604044218427, 237.31314795548,  237.022313398577,
      236.731538219239, 236.440820088463, 236.150156676603, 235.859545653262, 235.568984687177,
      235.278471446106, 234.988003596714, 234.697578804464, 234.407194733493, 234.11684904651,
      233.826539404669, 233.536263467463, 233.246018892605, 232.955803335909, 232.665614451178,
      232.375449890087, 232.085307302062, 231.795184334165, 231.505078630975, 231.214987834469,
      230.924909583904, 230.634841515695, 230.344781263294, 230.054726457074, 229.764674724201,
      229.474623688516, 229.18457097041,  228.894514186704, 228.604450950519, 228.314378871157,
      228.024295553972, 227.734198600245, 227.444085607058, 227.153954167165, 226.863801868863,
      226.573626295866, 226.283425027171, 225.99319563693,  225.702935694317, 225.412642763396,
      225.122314402988, 224.831948166535, 224.541541601968, 224.251092251568, 223.960597651829,
      223.670055333323, 223.379462820556, 223.088817631833, 222.798117279113, 222.50735926787,
      222.216541096945, 221.925660258406, 221.634714237403, 221.343700512016, 221.052616553113,
      220.761459824196, 220.470227781254, 220.178917872611, 219.88752753877,  219.596054212264,
      219.304495317496, 219.012848270583, 218.721110479199, 218.429279342417, 218.137352250542,
      217.845326584954, 217.553199717939, 217.260969012531, 216.968631822335, 216.676185491364,
      216.38362735387,  216.090954734167, 215.798164946459, 215.505255294667, 215.212223072249,
      214.919065562022, 214.625780035979, 214.332363755111, 214.038813969216, 213.74512791672,
      213.451302824482, 213.157335907605, 212.863224369246, 212.56896540042,  212.274556179803,
      211.979993873531, 211.685275635004, 211.390398604677, 211.09535990986,  210.800156664506,
      210.504785969002, 210.209244909957, 209.913530559984, 209.617639977489, 209.321570206443,
      209.025318276164, 208.72888120109,  208.432255980553, 208.135439598545, 207.838429023486,
      207.541221207988, 207.243813088616, 206.946201585644, 206.64838360281,  206.350356027071,
      206.052115728346, 205.753659559267, 205.454984354916, 205.156086932569, 204.856964091426,
      204.557612612347, 204.25802925758,  203.958210770486, 203.658153875258, 203.357855276643,
      203.057311659651, 202.75651968927,  202.455476010169, 202.154177246402, 201.852620001104,
      201.550800856188, 201.248716372033, 200.946363087171, 200.643737517966, 200.340836158293,
      200.037655479209, 199.73419192862,  199.430441930947, 199.12640188678,  198.822068172534,
      198.517437140097, 198.212505116471, 197.907268403412, 197.601723277062, 197.295865987576,
      196.989692758744, 196.683199787606, 196.376383244064, 196.069239270487, 195.761763981307,
      195.453953462612, 195.145803771734, 194.837310936831, 194.528470956452, 194.219279799115,
      193.909733402858, 193.599827674799, 193.289558490679, 192.978921694401, 192.667913097565,
      192.35652847899,  192.044763584231, 191.732614125089, 191.420075779116, 191.107144189099,
      190.793814962558, 190.48008367121,  190.165945850448, 189.851396998792, 189.536432577347,
      189.221048009237, 188.905238679043, 188.588999932225, 188.272327074532, 187.955215371407,
      187.637660047379, 187.319656285448, 187.001199226454, 186.682283968441, 186.362905566004,
      186.043059029632, 185.722739325032, 185.401941372446, 185.080660045957, 184.758890172776,
      184.436626532524, 184.113863856498, 183.790596826923, 183.46682007619,  183.142528186086,
      182.817715687002, 182.492377057134, 182.166506721662, 181.840099051919, 181.513148364547,
      181.185648920629, 180.857594924813, 180.528980524414, 180.199799808504, 179.870046806981,
      179.539715489622, 179.208799765119, 178.877293480094, 178.545190418097, 178.212484298583,
      177.879168775876, 177.545237438098, 177.210683806096, 176.875501332333, 176.539683399765,
      176.203223320689, 175.866114335581, 175.528349611894, 175.189922242846, 174.850825246174,
      174.511051562869, 174.170594055884, 173.829445508812, 173.487598624542, 173.145046023883,
      172.801780244163, 172.457793737797, 172.113078870825, 171.76762792142,  171.421433078367,
      171.074486439502, 170.726780010128, 170.378305701391, 170.029055328619, 169.679020609636,
      169.328193163023, 168.976564506358, 168.624126054407, 168.270869117275, 167.916784898525,
      167.561864493245, 167.206098886081, 166.849478949215, 166.49199544031,  166.133639000401,
      165.774400151738, 165.414269295582, 165.053236709952, 164.691292547315, 164.328426832229,
      163.964629458923, 163.599890188829, 163.234198648051, 162.867544324774, 162.499916566614,
      162.131304577905, 161.761697416914, 161.391083993001, 161.019453063699, 160.646793231731,
      160.273092941946, 159.898340478187, 159.522523960079, 159.145631339735, 158.767650398383,
      158.388568742905, 158.008373802291, 157.627052824005, 157.24459287025,  156.860980814149,
      156.476203335814, 156.09024691833,  155.703097843613, 155.314742188181, 154.925165818797,
      154.534354388005, 154.142293329547, 153.748967853652, 153.354362942201, 152.958463343765,
      152.561253568499, 152.162717882902, 151.762840304435, 151.36160459598,  150.958994260157,
      150.554992533468, 150.14958238029,  149.742746486685, 149.33446725404,  148.924726792525,
      148.513506914356, 148.10078912687,  147.686554625391, 147.270784285891, 146.853458657427,
      146.434557954363, 146.014062048349, 145.591950460062, 145.1682023507,   144.742796513209,
      144.315711363248, 143.886924929868, 143.456414845905, 143.02415833807,  142.59013221673,
      142.154312865357, 141.716676229652, 141.277197806305, 140.835852631407, 140.392615268466,
      139.947459796049, 139.500359795001, 139.051288335247, 138.600217962147, 138.147120682397,
      137.691967949446, 137.234730648417, 136.775379080504, 136.31388294684,  135.850211331784,
      135.384332685637, 134.916214806732, 134.445824822895, 133.973129172231, 133.498093583221,
      133.020683054083, 132.540861831389, 132.058593387872, 131.573840399417, 131.086564721181,
      130.596727362806, 130.104288462692, 129.609207261265, 129.111442073224, 128.610950258685,
      128.1076881932,   127.601611236576, 127.092673700438, 126.580828814496, 126.06602869142,
      125.548224290278, 125.027365378455, 124.503400491983, 123.976276894188, 123.445940532589,
      122.912335993931, 122.375406457284, 121.835093645083, 121.291337772009, 120.744077491599,
      120.19324984045,  119.638790179902, 119.080632135042, 118.518707530896, 117.952946325646,
      117.383276540691, 116.809624187397, 116.231913190317, 115.650065306689, 115.064000041996,
      114.473634561337, 113.878883596377, 113.279659347588, 112.675871381503, 112.067426522668,
      111.454228739965, 110.836179026936, 110.213175275738, 109.585112144301, 108.951880916254,
      108.313369353138, 107.669461538374, 107.020037712447, 106.364974098686, 105.704142718993,
      105.037411198816, 104.364642560591, 103.685695004829, 103.000421677948, 102.308670425859,
      101.610283532258, 100.905097440442, 100.192942457401, 99.4736424388001, 98.7470144533468,
      98.0128684248865, 97.271006750435,  96.5212238921595, 95.7633059411416, 94.9970301505344,
      94.2221644354899, 93.4384668369614, 92.6456849461916, 91.8435552863558, 91.0318026474598,
      90.210139370165,  89.3782645737369, 88.5358633227841, 87.6826057268308, 86.8181459661034,
      85.9421212361053, 85.0541506026893, 84.1538337583136, 83.2407496690189, 82.3144551003436,
      81.3744830088787, 80.4203407844187, 79.4515083256666, 78.4674359301148, 77.4675419760449,
      76.4512103714547, 75.4177877410738, 74.366580318369,  73.2968505044278, 72.2078130497309,
      71.0986308078575, 69.9684100019336, 68.8161949348092, 67.6409620622479, 66.4416133343433,
      65.2169686934555, 63.9657575964625, 62.6866094042216, 61.3780424506896, 60.0384515667609,
      58.6660937877094, 57.2590719157305, 55.8153155373626, 54.3325590053056, 52.8083157797977,
      51.2398483787353, 49.6241329979274, 47.9578176192448, 46.2371721055055, 44.4580283594823,
      42.6157080616047, 40.7049347410408, 38.7197258964346, 36.6532594449655, 34.4977067597887,
      32.2440216772872, 29.8816706803788, 27.3982832941422, 24.7791924216799, 22.0068199776701,
      19.0598404110202, 15.9120175737242, 12.5305477756655, 8.87363216383865, 4.88680063758994,
      0.49712168441752, -4.3963646466336, -9.9394231379518, -16.354370122913, -24.006564798528,
      -33.565096745757, -46.487239604888, -67.218190864903, -90.000000000000,
   };
   
   if (adc > sizeof(adc_to_temp)/sizeof(adc_to_temp[0]))
      adc = sizeof(adc_to_temp)/sizeof(adc_to_temp[0]);
   
   return adc_to_temp[adc];
}
